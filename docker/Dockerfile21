FROM ubuntu:jammy

RUN apt-get update -y && \
    apt-get install -y \
        curl \
        wget \
        git \
        gcc-x86-64-linux-gnu \
        g++-x86-64-linux-gnu \
        gcc-i686-linux-gnu \
        g++-i686-linux-gnu && \
    apt-get clean

RUN export java_version=amazon-corretto@1.21 && \
    export JAVA_VERSION=${java_version} && \
    curl -sL https://github.com/shyiko/jabba/raw/master/install.sh | JABBA_COMMAND="install $JAVA_VERSION -o /jdk" bash && \
    echo 'export JAVA_HOME="/jdk"' >> ~/.bashrc && \
    echo 'PATH=/jdk/bin:$PATH' >> ~/.bashrc

ENV JAVA_HOME "/jdk"
ENV PATH      "/jdk/bin:$PATH"

RUN mkdir -p /opt
WORKDIR /opy

RUN wget --no-verbose https://maven-central.storage-download.googleapis.com/maven2/org/apache/maven/apache-maven/3.8.7/apache-maven-3.8.7-bin.tar.gz && \
    tar xzf apache-maven-3.8.7-bin.tar.gz && \
    ln -s apache-maven-3.8.7 maven && \
    ln -s /opt/maven/bin/mvn /usr/bin/mvn

RUN wget --no-verbose https://github.com/Kitware/CMake/releases/download/v3.29.3/cmake-3.29.3-linux-x86_64.sh && \
    chmod +x cmake-3.29.3-linux-x86_64.sh && \
    yes | ./cmake-3.29.3-linux-x86_64.sh

ENV MAVEN_HOME 	"/opt/maven"
ENV PATH 	"/opt/maven/bin:$PATH"
ENV PATH 	"/opt/cmake-3.29.3-linux-x86_64/bin:$PATH"

RUN mkdir -p /workspace/Brotli4j
WORKDIR /workspace/Brotli4j

RUN echo "/jdk/lib/amd64" >> /etc/ld.so.conf
RUN echo "/jdk/jre/lib/amd64/" >> /etc/ld.so.conf

RUN ldconfig

RUN echo "export MAVEN_HOME=/opt/maven" >> ~/.bashrc
RUN echo "export PATH=/opt/maven/bin:\$PATH  " >>  ~/.bashrc
RUN echo "export PATH=/opt/cmake-3.29.3-linux-x86_64/bin:\$PATH " >>  ~/.bashrc